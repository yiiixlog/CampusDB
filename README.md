# 校園餐飲點餐系統 - 資料庫設計文檔

## 概述

這是一個展示 **SQL 與 NoSQL 混合架構** 的校園餐飲點餐系統完整資料庫設計方案。本專案以「顧客 — 訂單 — 店家」為核心，提供學生點餐、店家管理、訂單追蹤、訊息與公告等功能，並對比兩種資料庫在設計與應用上的優缺點。

**核心特性：**
- **混合架構**：SQL 處理核心業務，NoSQL 負責高頻資料
- **第三正規化設計**：確保資料結構完整、一致、無重複
- **ACID 交易保證**：訂單、付款等關鍵操作的一致性
- **多角色權限**：學生、店家、管理員的清晰權限隔離

---

## 🗄️ 資料庫架構設計

### 核心架構圖

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend 層                          │
│              （學生端 / 店家端 / 管理端）               │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│               Express.js REST API 層                    │
│                  （後端業務邏輯）                       │
└──────┬──────────────────────────────┬───────────────────┘
       │                              │
┌──────▼────────────────┐  ┌─────────▼─────────────────┐
│   SQL 資料庫層        │  │  NoSQL 資料庫層          │
│    (MySQL)            │  │   (MongoDB)              │
├──────────────────────┤  ├──────────────────────────┤
│ • User 使用者        │  │ • Message 訊息           │
│ • Store 店家         │  │ • PublicNotice 公告     │
│ • Order 訂單         │  │ • 非結構化資料           │
│ • MenuItem 菜單      │  │ • 高頻讀寫資料           │
│ • Payment 付款       │  │                         │
│ • Review 評價        │  │                         │
│ • 交易關鍵資料       │  │                         │
└──────────────────────┘  └──────────────────────────┘
```

---

## SQL 設計特性（CAMPUS.sql）

| 特性 | 說明 |
|------|------|
| **ACID 交易** | 確保訂單、付款等操作的強一致性 |
| **參照完整性** | 外鍵約束防止孤兒資料，確保資料有效性 |
| **結構清晰** | 固定欄位與關聯，適合複雜報表與統計 |
| **正規化設計** | 第三正規化（3NF）避免資料重複 |
| ⚠️ **Schema 變動成本高** | 新增欄位需遷移，影響上線時間 |
| ⚠️ **水平擴充不便** | 多機分散需額外設計（分片、複製等） |

---

## NoSQL 資料庫設計（MongoDB）

### 設計理念

MongoDB 主要用於儲存**高頻寫入、格式靈活**的資料：
- 訊息系統：頻繁新增、讀取查詢
- 公告系統：欄位可能動態增減


### NoSQL 設計優勢

| 特性 | 說明 |
|------|------|
| **靈活 Schema** | 無需事先定義欄位，可動態新增（讀取狀態、標籤等） |
| **寫入效能高** | 適合高頻寫入場景（聊天訊息） |
| **水平擴充** | Sharding 分散資料，支援 PB 級規模 |
| **嵌套文件** | 相關資料內聚，減少 JOIN 操作 |
| ⚠️ **沒有交易** | 複雜跨文件操作難以保證一致性 |
| ⚠️ **維護關聯困難** | 無外鍵約束，需應用層管理 |

---

## 💡 SQL vs NoSQL 使用決策矩陣

| 場景 | SQL（CAMPUS.sql） | NoSQL（MongoDB） | 推薦 |
|------|:---:|:---:|:---:|
| **訂單、付款、店家等核心業務** | 強一致性、交易安全、外鍵清晰 | 維護複雜關聯困難 | **SQL** |
| **定期報表、營收統計、排行榜** | JOIN + GROUP BY | 需複雜 Aggregation | **SQL** |
| **高頻率訊息、公告、推送** | ⚠️ 寫入壓力大、Schema 固定 | 文件簡單、寫入快 | **NoSQL** |
| **結構常變動的資料** | ⚠️ 每次修改需 Migration | 直接新增欄位 | **NoSQL** |
| **資料強關聯與完整性** | 鍵約束直接支援 | ⚠️ 應用層自己控管 | **SQL** |
| **即時推播** | ⚠️ 整列讀取成本高 | 文件導向，直接推送 | **NoSQL** |

---

## 系統分層架構

### 後端分層結構

```
Express Server (Port 3000)
│
├─ API Routes 層
│  ├── /api/orders          → 訂單相關
│  ├── /api/payments        → 付款相關
│  ├── /api/messages        → 訊息相關（MongoDB）
│  ├── /api/notices         → 公告相關（MongoDB）
│  └── /api/users           → 使用者相關
│
├─ Controller 層（業務邏輯）
│  ├── OrderController
│  ├── PaymentController
│  ├── MessageController
│  └── NoticeController
│
├─ Service 層（資料訪問邏輯）
│  ├── SQLService
│  │  ├── UserService
│  │  ├── OrderService
│  │  ├── PaymentService
│  │  └── ReviewService
│  │
│  └── NoSQLService
│     ├── MessageService
│     └── NoticeService
│
└─ Database 層
   ├── MySQL Connection Pool
   └── MongoDB Connection
```

### 資料流向示例

**場景：學生提交訂單並支付**

```
1. 前端提交訂單表單
   ↓
2. Express 接收 POST /api/orders
   ↓
3. OrderController 驗證資料
   ↓
4. OrderService（SQL）
   - 檢查菜單與庫存
   - 插入 Order、OrderItem 記錄
   - 檢查付款
   ↓
5. PaymentService（SQL）
   - 調用第三方支付 API
   - 插入 Payment 記錄
   ↓
6. NotificationService（MongoDB）
   - 插入 Message 文件（"訂單已確認"）
   - 推送通知到前端
   ↓
7. 返回 200 OK 給前端
```

---

## 使用技術棧

### 後端

| 技術 | 用途 |
|------|------|
| **Node.js** | JavaScript 運行環境 |
| **Express.js** | Web 框架 |
| **MySQL** | 關聯式資料庫（核心業務資料） |
| **MongoDB** | 文件資料庫（訊息、公告） |
| **Mongoose** | MongoDB 連接與 Schema 驗證 |

### 前端

| 技術 | 用途 |
|------|------|
| **HTML5 / CSS3** | 頁面結構與樣式 |
| **JavaScript / ES6+** | 互動邏輯 |
| **Fetch API** | HTTP 請求 |

### 開發工具

| 工具 | 用途 |
|------|------|
| **npm / pnpm** | 套件管理 |
| **nodemon** | 自動重啟開發伺服器 |
| **Postman** | API 測試 |
| **MySQL Workbench** | SQL 資料庫管理 |
| **MongoDB Compass** | MongoDB 視覺化工具 |
| **Git** | 版本控制 |

---

## 資料庫初始化

```bash
# 創建 MySQL 資料庫
mysql -u root -p < database/CAMPUS.sql

# 創建 MongoDB 集合
mongo < nosql/init-mongodb.js

# 配置環境變數
cp backend/.env.example backend/.env
```

---

## 團隊信息

### 專案

- **專案類型**：課程專題 / 學習型專案
- **組別**：第七組 生存進化
- **課程**：資料庫管理系統（DBMS）

### 核心目標

本專案旨在讓開發團隊親身體驗：

1. **同一業務需求的多種設計方案**
   - 如何在 SQL 中設計？
   - 如何在 NoSQL 中設計？
   - 兩者的優缺點對比

2. **資料庫選型決策**
   - 什麼資料適合放在關聯式資料庫？
   - 什麼資料適合放在文件資料庫？
   - 如何在兩者間取得平衡？

---

**最後更新**：2025 年 12 月 7 日  
